<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Correlation on R Doodles</title>
    <link>/tags/correlation/</link>
    <description>Recent content in Correlation on R Doodles</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 03 Jan 2019 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="/tags/correlation/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Expected covariances in a causal network</title>
      <link>/2019/01/expected-covariances-in-a-causal-network/</link>
      <pubDate>Thu, 03 Jan 2019 00:00:00 +0000</pubDate>
      
      <guid>/2019/01/expected-covariances-in-a-causal-network/</guid>
      <description>


&lt;p&gt;This is a skeleton post&lt;/p&gt;
&lt;div id=&#34;standardized-variables-wrights-rules&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Standardized variables (Wright’s rules)&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;n &amp;lt;- 10^5

# z is the common cause of g1 and g2
z &amp;lt;- rnorm(n)

# effects of z on g1 and g2
b1 &amp;lt;- 0.7
b2 &amp;lt;- 0.7
r12 &amp;lt;- b1*b2
g1 &amp;lt;- b1*z + sqrt(1-b1^2)*rnorm(n)
g2 &amp;lt;- b2*z + sqrt(1-b2^2)*rnorm(n)
var(g1) # E(VAR(g1)) = 1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.997149&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;var(g2) # E(VAR(g2)) = 1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.9972956&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;cor(g1, g2) # E(COR(g1,g2)) = b1*b2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.4881183&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;b1*b2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.49&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# effects of g1 and g2 on y1 and y2
a11 &amp;lt;- 0.5 # effect of g1 on y1
a12 &amp;lt;- 0.5 # effect of g1 on y2
a21 &amp;lt;- 0.5 # effect of g2 on y1
a22 &amp;lt;- 0.5 # effect of g2 on y2
r2.1 &amp;lt;- a11^2 + a21^2 + 2*a11*a21*b1*b2 # systematic variance of y1
r2.2 &amp;lt;- a12^2 + a22^2 + 2*a12*a22*b1*b2 # systematic variance of y1
y1 &amp;lt;- a11*g1 + a21*g2 + sqrt(1-r2.1)*rnorm(n)
y2 &amp;lt;- a12*g1 + a22*g2 + sqrt(1-r2.2)*rnorm(n)
var(y1) # E() = 1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.9963031&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;var(y2) # E() = 1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.994697&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;cor(y1, y2) # E() = a11*a12 + a21*a22 + a11*r12*a22 + a21*r12*a12&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.7454303&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a11*a12 + a21*a22 + a11*r12*a22 + a21*r12*a12 # sum of all paths&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.745&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;non-standardized-variables-wrights-rules&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Non-standardized variables (Wright’s rules)&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;n &amp;lt;- 10^6

# z is the common cause of g1 and g2
sigma_z &amp;lt;- 2
z &amp;lt;- rnorm(n, sd=sigma_z)

# effects of z on g1 and g2
b1 &amp;lt;- 1.2
b2 &amp;lt;- 1.2
s12 &amp;lt;- b1*b2*sigma_z^2 # cov(g1, g2)

sigma.sq_g1.sys &amp;lt;- (b1*sigma_z)^2 # systematic variance of g1
sigma.sq_g2.sys &amp;lt;- (b2*sigma_z)^2 # systematic variance of g1
r2.g1 &amp;lt;- 0.9 # R^2 for g1
r2.g2 &amp;lt;- 0.9 # R^2 for g2
sigma.sq_g1 &amp;lt;- sigma.sq_g1.sys/r2.g1
sigma.sq_g2 &amp;lt;- sigma.sq_g2.sys/r2.g2
sigma_g1 &amp;lt;- sqrt(sigma.sq_g1)
sigma_g2 &amp;lt;- sqrt(sigma.sq_g2)

g1 &amp;lt;- b1*z + sqrt(sigma.sq_g1 - sigma.sq_g1.sys)*rnorm(n)
g2 &amp;lt;- b2*z + sqrt(sigma.sq_g2 - sigma.sq_g2.sys)*rnorm(n)
var(g1) # E(VAR(g1)) = sigma.sq_g1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 6.400034&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;var(g2) # E(VAR(g2)) = sigma.sq_g2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 6.403562&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sigma.sq_g1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 6.4&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sigma.sq_g2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 6.4&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;cov(g1,g2) # E() = b1*b2*sigma_z^2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 5.759874&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;s12 # b1*b2*sigma_z^2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 5.76&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# effects of g1 and g2 on y1 and y2
a11 &amp;lt;- 1.5 # effect of g1 on y1
a12 &amp;lt;- 1.5 # effect of g1 on y2
a21 &amp;lt;- 3 # effect of g2 on y1
a22 &amp;lt;- 1.5 # effect of g2 on y2
sigma.sq_y1.sys &amp;lt;- a11^2*sigma.sq_g1 + a21^2*sigma.sq_g2 + 2*a11*a21*s12 # systematic variance of y1
sigma.sq_y2.sys &amp;lt;- a12^2*sigma.sq_g1 + a22^2*sigma.sq_g2 + 2*a12*a22*s12 # systematic variance of y2
r2.1 &amp;lt;- 0.9 # R^2 for y1
r2.2 &amp;lt;- 0.9 # R^2 for y2
sigma.sq_y1 &amp;lt;- sigma.sq_y1.sys/r2.1
sigma.sq_y2 &amp;lt;- sigma.sq_y2.sys/r2.2
sigma_y1 &amp;lt;- sqrt(sigma.sq_y1)
sigma_y2 &amp;lt;- sqrt(sigma.sq_y2)
y1 &amp;lt;- a11*g1 + a21*g2 + sqrt(sigma.sq_y1 - sigma.sq_y1.sys)*rnorm(n)
y2 &amp;lt;- a12*g1 + a22*g2 + sqrt(sigma.sq_y2 - sigma.sq_y2.sys)*rnorm(n)
var(y1) # E() = sigma.sq_y1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 137.5161&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;var(y2) # E() = sigma.sq_y1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 60.87395&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sigma.sq_y1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 137.6&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sigma.sq_y2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 60.8&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a11.s &amp;lt;- a11*sigma_g1/sigma_y1
a12.s &amp;lt;- a12*sigma_g1/sigma_y2
a21.s &amp;lt;- a21*sigma_g2/sigma_y1
a22.s &amp;lt;- a22*sigma_g2/sigma_y2
r12 &amp;lt;- s12/sigma_g1/sigma_g2
r12 # expected correlation between g1 and g2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.9&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;cor(g1, g2) # actual correlation between g1 and g2&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.8997275&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# covariance y1 and y2
cov(y1, y2) #&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 82.10576&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;(a11.s*a12.s + a21.s*a22.s + a11.s*r12*a22.s + a21.s*r12*a12.s)*sigma_y1*sigma_y2 # expected cov(y1, y2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 82.08&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# more compact and not using the standardized parameters
# = sum of paths where path coef = stand coef * parent sd
a11*a12*sigma.sq_g1 + a21*a22*sigma.sq_g2 + a11*s12*a22 + a21*s12*a12&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 82.08&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# correlation y1 and y2
cor(y1, y2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.8973897&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;a11.s*a12.s + a21.s*a22.s + a11.s*r12*a22.s + a21.s*r12*a12.s&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.8973799&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;expected-value-of-b-with-missing-covariate&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Expected value of b with missing covariate&lt;/h2&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;coef(summary(lm(y1 ~ g1 + g2)))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                Estimate  Std. Error    t value   Pr(&amp;gt;|t|)
## (Intercept) 0.006165963 0.003710027   1.661972 0.09651863
## g1          1.503519031 0.003360074 447.466106 0.00000000
## g2          2.994464649 0.003359148 891.435776 0.00000000&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;coef(summary(lm(y1 ~ g1)))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                Estimate  Std. Error      t value  Pr(&amp;gt;|t|)
## (Intercept) 0.004241297 0.004970132    0.8533571 0.3934615
## g1          4.198463665 0.001964609 2137.0475423 0.0000000&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# expected = direct + cor*indirect using cor
a11 + cor(g1,g2)*a21&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 4.199183&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# expected = direct + cor*indirect, using cov as model param
a11 + (s12/sigma_g1/sigma_g2)*a21&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 4.2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# need to correct if different variances in g1 and g2
# expected is a11 + rho*sigma_g2/sigma_g1*a21
rho &amp;lt;- s12/sigma_g1/sigma_g2
a11 + rho*sigma_g2/sigma_g1*a21&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 4.2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# this is equal to
a11 + s12/sigma_g1^2*a21&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 4.2&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# which is equal to a11 + b21*a21&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>