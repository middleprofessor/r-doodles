---
title: Type 3 ANOVA in R -- an easy way to publish wrong tables
author: Jeff Walker
date: '2020-10-23'
slug: type-3-anova-in-r-an-easy-way-to-publish-wrong-tables
categories:
  - stats 101
tags:
  - anova
keywords:
  - tech
---



<p>In R, so-called “Type I sums of squares” are default. With balanced designs, inferential statistics from Type I, II, and III sums of squares are equal. But you to get the correct Type III statistics, you must set the contrasts in the model matrix to <code>contr.sum</code>. Type III sums of squares are returned using <code>car::Anova</code> instead of base R <code>anova</code>.</p>
<p>Best practice: many google searches will return code that resets the contrasts globally using <code>options</code>. I use code that specifies the contrasts only in the linear model that we want to specify <code>contr.sum</code>. This is much safer, at least if you like to interpret model coefficients using default R contrasts – <a href="https://rdoodles.rbind.io/2019/07/is-the-power-to-test-an-interaction-effect-less-than-that-for-a-main-effect/">the coefficients are differences relative to a reference and the interactions are relative to what you would have gotten if things were additive</a>. If I reset the contrasts globally using <code>options</code>, and then, in code further down the document, fit a linear model and interpret the coefficients as if the model was fit with R default contrasts, then my interpretation of the effects would be wrong.</p>
<pre class="r"><code>library(data.table)
library(car)</code></pre>
<pre><code>## Loading required package: carData</code></pre>
<pre class="r"><code>n &lt;- 5
fd &lt;- data.table(fac1 = rep(c(&quot;cn&quot;,&quot;tr&quot;), each = n*2*2),
                 fac2 = rep(rep(c(&quot;wt&quot;, &quot;ko&quot;), each = n*2), 2),
                 fac3 = rep(rep(rep(c(&quot;f&quot;,&quot;m&quot;), each = n),2),2),
                 y = rnorm(n*2*2*2))</code></pre>
<div id="linear-model-set-with-r-defaults-using-anova-correct-type-i" class="section level1">
<h1>linear model set with R defaults, using anova – correct Type I</h1>
<pre class="r"><code>m1 &lt;- lm(y ~ fac1*fac2*fac3, data = fd)
anova(m1)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: y
##                Df  Sum Sq Mean Sq F value  Pr(&gt;F)  
## fac1            1  0.0531 0.05313  0.0682 0.79568  
## fac2            1  0.8471 0.84706  1.0869 0.30497  
## fac3            1  0.5727 0.57271  0.7349 0.39769  
## fac1:fac2       1  2.9096 2.90962  3.7334 0.06223 .
## fac1:fac3       1  0.7673 0.76727  0.9845 0.32853  
## fac2:fac3       1  1.1307 1.13072  1.4509 0.23722  
## fac1:fac2:fac3  1  1.2357 1.23569  1.5856 0.21707  
## Residuals      32 24.9390 0.77934                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="linear-model-set-with-contr.sum-using-anova-correct-type-iii" class="section level1">
<h1>linear model set with contr.sum, using Anova – correct Type III</h1>
<pre class="r"><code>type3 &lt;- list(fac1 = contr.sum, fac2 = contr.sum, fac3 = contr.sum)
m2 &lt;- lm(y ~ fac1*fac2*fac3, data = fd, contrasts = type3)
Anova(m2, type = 3) # correct type 3</code></pre>
<pre><code>## Anova Table (Type III tests)
## 
## Response: y
##                 Sum Sq Df F value  Pr(&gt;F)  
## (Intercept)     0.3216  1  0.4126 0.52521  
## fac1            0.0531  1  0.0682 0.79568  
## fac2            0.8471  1  1.0869 0.30497  
## fac3            0.5727  1  0.7349 0.39769  
## fac1:fac2       2.9096  1  3.7334 0.06223 .
## fac1:fac3       0.7673  1  0.9845 0.32853  
## fac2:fac3       1.1307  1  1.4509 0.23722  
## fac1:fac2:fac3  1.2357  1  1.5856 0.21707  
## Residuals      24.9390 32                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="linear-model-set-with-r-defaults-using-anova-wrong-type-iii" class="section level1">
<h1>linear model set with R defaults, using Anova – wrong Type III</h1>
<p>This is garbage.</p>
<pre class="r"><code>m1 &lt;- lm(y ~ fac1*fac2*fac3, data = fd)
Anova(m1, type = 3) # correct type 3</code></pre>
<pre><code>## Anova Table (Type III tests)
## 
## Response: y
##                 Sum Sq Df F value Pr(&gt;F)  
## (Intercept)     0.3228  1  0.4142 0.5244  
## fac1            0.7230  1  0.9277 0.3427  
## fac2            0.4827  1  0.6194 0.4371  
## fac3            1.0566  1  1.3557 0.2529  
## fac1:fac2       0.1765  1  0.2265 0.6374  
## fac1:fac3       0.0278  1  0.0356 0.8515  
## fac2:fac3       2.3653  1  3.0349 0.0911 .
## fac1:fac2:fac3  1.2357  1  1.5856 0.2171  
## Residuals      24.9390 32                 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
