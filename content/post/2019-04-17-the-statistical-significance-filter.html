---
title: The statistical significance filter
author: Jeff Walker
date: '2019-04-17'
slug: the-statistical-significance-filter
categories:
  - stats 101
tags:
  - fake data
  - p-values
keywords:
  - tech
---



<div id="setup" class="section level1">
<h1>Setup</h1>
<pre class="r"><code>library(ggplot2)
library(GGally)
library(data.table)

source(&quot;../R/fake_x.R&quot;) # bookdown</code></pre>
</div>
<div id="why-reported-effect-sizes-are-inflated" class="section level1">
<h1>Why reported effect sizes are inflated</h1>
<p>This post is motivated by many discussions in Gelman’s blog <a href="https://statmodeling.stat.columbia.edu/2011/09/10/the-statistical-significance-filter/">but start here</a></p>
<p>When we estimate an effect<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, the estimate will be a little inflated or a little diminished relative to the true effect but the expectation of the effect is the true effect. If all effects were reported, there would be no bias toward inflated effects. Reported effects are inflated if we use p-values to decide which to report and which to archive in the file drawer.</p>
<p>The magnitude of an estimate of an effect is a function of its true effect size plus sampling error (this is with a perfectly designed and executed study. In any real study there will be biases of various sorts). The absolute magnitude of sampling error is bigger with smaller <span class="math inline">\(n\)</span>. The relative magnitude is bigger for smaller true effect size. Consequently, estimates in low powered studies (some combination of low <span class="math inline">\(n\)</span> and small true effect size) can be wildly off, especially relative to the true effect size. In low powered studies, it is these “wildly-off” estimates that are big enough to have <span class="math inline">\(p &lt; 0.05\)</span>. This phenomenon attenuates as power increases because estimates are less and less wildely-off.</p>
<p>Here is a simulation of this</p>
</div>
<div id="exploration-1" class="section level1">
<h1>Exploration 1</h1>
<p>Modeling a typical set of experiments in ecology or physiology with <span class="math inline">\(p\)</span> independent responses each with the same standardized effect size. How big are the reported effect sizes for the subset with <span class="math inline">\(p.val &lt; 0.05\)</span> (with or without correction for multiple testing). Make this a function of power.</p>
<pre class="r"><code>n &lt;- 20 # per treatment level. power will be a function of effect size
np1 &lt;- n+1
N &lt;- 2*n
niter &lt;- 100 # number of iterations for each combination of fake data parameters
treatment_levels &lt;- c(&quot;Cn&quot;, &quot;Tr&quot;)
Treatment &lt;- rep(treatment_levels, each=n)
p &lt;- 50
b &lt;- pval &lt;- numeric(p)
combo &lt;- 0 # which treatment combo
res_table &lt;- data.table(NULL)
for(beta_1 in c(0.05, 0.15, 0.5, 1)){
  combo &lt;- combo + 1
  j1 &lt;- 0
  j &lt;- 0
  res &lt;- matrix(NA, nrow=niter*p, ncol=3)
  colnames(res) &lt;- c(&quot;ID&quot;, &quot;b&quot;, &quot;pval&quot;)
  for(iter in 1:niter){
    j1 &lt;- j1 + j # completed row -- start row will be this plus 1
    Y &lt;- matrix(rnorm(n*2*p), nrow=n*2, ncol=p)
    Y[np1:N,] &lt;- Y[np1:N,] + beta_1
    fit &lt;- lm(Y ~ Treatment)
    fit.coefs &lt;- coef(summary(fit))
    for(j in 1:p){# inefficient...how do I extract this without a 
      res[j1 + j, &quot;ID&quot;] &lt;- niter*(combo - 1) + iter
      res[j1 + j, &quot;b&quot;] &lt;- fit.coefs[[j]][&quot;TreatmentTr&quot;, &quot;Estimate&quot;]
      res[j1 + j, &quot;pval&quot;] &lt;- fit.coefs[[j]][&quot;TreatmentTr&quot;, &quot;Pr(&gt;|t|)&quot;]
    }
  } # iter
  res_table &lt;- rbind(res_table, data.table(beta=beta_1, res))
}</code></pre>
</div>
<div id="unconditional-means-power-and-sign-error" class="section level1">
<h1>Unconditional means, power, and sign error</h1>
<p>The unconditional mean is the mean effect size. I report the mean of the raw values (the expectation is beta) and the mean of the absolute values (so the mean magnitude)</p>
<pre class="r"><code>res_table[, .(mean_unconditional=mean(b),
              mean_abs_unconditional=mean(abs(b)),
              power = sum(pval &lt; 0.05 &amp; b &gt; 0)/niter/p,
              sign.error=sum(pval &lt; 0.05 &amp; b &lt; 0)/niter/p), by=.(beta)]</code></pre>
<pre><code>##    beta mean_unconditional mean_abs_unconditional  power sign.error
## 1: 0.05         0.05171193              0.2525600 0.0324     0.0192
## 2: 0.15         0.14733072              0.2776393 0.0650     0.0082
## 3: 0.50         0.50025821              0.5159192 0.3384     0.0002
## 4: 1.00         0.99680789              0.9969055 0.8712     0.0000</code></pre>
</div>
<div id="conditional-means" class="section level1">
<h1>Conditional means</h1>
<p>The conditional mean is the mean effect size conditional on pval &lt; filter.</p>
<div id="filter-0.05" class="section level2">
<h2>filter = 0.05</h2>
<pre class="r"><code>res_table[pval &lt; 0.05, .(mean_conditional=mean(b),
                         mean_abs.conditional=mean(abs(b)),
                         multiplier = mean(abs(b))/beta), by=.(beta)]</code></pre>
<pre><code>##    beta mean_conditional mean_abs.conditional multiplier
## 1: 0.05        0.1894618            0.7287291  14.574582
## 2: 0.15        0.5801990            0.7424163   4.949442
## 3: 0.50        0.8329258            0.8336378   1.667276
## 4: 1.00        1.0711961            1.0711961   1.071196</code></pre>
</div>
<div id="filter-0.2" class="section level2">
<h2>filter = 0.2</h2>
<pre class="r"><code>res_table[pval &lt; 0.2, .(mean_conditional=mean(b),
                         mean_abs.conditional=mean(abs(b)),
                         multiplier = mean(abs(b))/beta), by=.(beta)]</code></pre>
<pre><code>##    beta mean_conditional mean_abs.conditional multiplier
## 1: 0.05        0.1520004            0.5524195  11.048391
## 2: 0.15        0.3931652            0.5696077   3.797385
## 3: 0.50        0.6922316            0.6966395   1.393279
## 4: 1.00        1.0214667            1.0214667   1.021467</code></pre>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>for example, in an experiment, if we compare the mean response between a control group and a treated group, the difference in means is the effect. More generally, an effect is the coefficient of a linear model<a href="#fnref1">↩</a></p></li>
</ol>
</div>
